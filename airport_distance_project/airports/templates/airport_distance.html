<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Airport Distance</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="">
    </head>
    <body>
        <h1>Calculadora de Distancia entre Aeropuertos</h1>
    
    <!-- FORMULARIO BÁSICO -->
    <form id="airportForm">
        {% csrf_token %}
        
        <label for="aeropuerto_origen">Aeropuerto Origen:</label>
        <input 
            type="text" 
            id="aeropuerto_origen" 
            name="aeropuerto_origen"
            placeholder="BOG" 
            maxlength="3" 
            required
        >
        
        <br><br>
        
        <label for="aeropuerto_destino">Aeropuerto Destino:</label>
        <input 
            type="text" 
            id="aeropuerto_destino" 
            name="aeropuerto_destino"
            placeholder="ANF" 
            maxlength="3" 
            required
        >
        
        <br><br>
        
        <button type="submit">Calcular Distancia</button>
    </form>
    
    <!-- ÁREA DE RESULTADOS -->
    <div id="resultados" style="display: none;">
        <h2>Resultados:</h2>
        <p><strong>Origen:</strong> <span id="origen"></span></p>
        <p><strong>Destino:</strong> <span id="destino"></span></p>
        <p><strong>Distancia:</strong> <span id="distancia"></span> km</p>
    </div>
    
    <!-- ÁREA DE ERRORES -->
    <div id="error" style="display: none; color: red;"></div>

    <script>
        // JAVASCRIPT ESENCIAL
        document.getElementById('airportForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Limpiar resultados anteriores
            document.getElementById('resultados').style.display = 'none';
            document.getElementById('error').style.display = 'none';
            
            // Capturar datos del formulario
            const formData = new FormData(this);
            
            // Enviar petición AJAX
            fetch('/calculate/', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': formData.get('csrfmiddlewaretoken')
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Mostrar resultados exitosos
                    document.getElementById('origen').textContent = 
                        data.aeropuerto_origen.codigo + ' - ' + data.aeropuerto_origen.nombre;
                    
                    document.getElementById('destino').textContent = 
                        data.aeropuerto_destino.codigo + ' - ' + data.aeropuerto_destino.nombre;
                    
                    document.getElementById('distancia').textContent = data.distancia_km;
                    document.getElementById('resultados').style.display = 'block';
                    
                } else {
                    // Mostrar error
                    document.getElementById('error').textContent = data.error;
                    document.getElementById('error').style.display = 'block';
                }
            })
            .catch(error => {
                // Error de conexión
                document.getElementById('error').textContent = 'Error de conexión';
                document.getElementById('error').style.display = 'block';
            });
        });
    </script>
    </body>
</html>